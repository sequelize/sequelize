function EntryWriter(e){var t=this;if(!(t instanceof EntryWriter))return new EntryWriter(e);Stream.apply(this),t.writable=!0,t.readable=!0,t._stream=new BlockStream(512),t._stream.on("data",function(e){t.emit("data",e)}),t._stream.on("drain",function(){t.emit("drain")}),t._stream.on("end",function(){t.emit("end"),t.emit("close")}),t.props=e,e.type==="Directory"&&(e.size=0),e.ustar="ustar\0",e.ustarver="00",t.path=e.path,t._buffer=[],t._didHeader=!1,t._meta=!1,t.on("pipe",function(){t._process()})}module.exports=EntryWriter;var tar=require("../tar.js"),TarHeader=require("./header.js"),Entry=require("./entry.js"),inherits=require("../vendor/inherits/inherits.js"),BlockStream=require("../vendor/block-stream/block-stream.js"),ExtendedHeaderWriter,Stream=require("stream").Stream,EOF={};inherits(EntryWriter,Stream),EntryWriter.prototype.write=function(e){return this._ended?this.emit("error",new Error("write after end")):(this._buffer.push(e),this._process(),this._needDrain=this._buffer.length>0,!this._needDrain)},EntryWriter.prototype.end=function(e){e&&this._buffer.push(e),this._buffer.push(EOF),this._ended=!0,this._process(),this._needDrain=this._buffer.length>0},EntryWriter.prototype.pause=function(){this._paused=!0,this.emit("pause")},EntryWriter.prototype.resume=function(){this._paused=!1,this.emit("resume"),this._process()},EntryWriter.prototype.add=function(e){return this.parent?(this._ended||this.end(),this.parent.add(e)):this.emit("error",new Error("no parent"))},EntryWriter.prototype._header=function(){if(this._didHeader)return;this._didHeader=!0;var e=TarHeader.encode(this.props);if(this.props.needExtended&&!this._meta){var t=this;ExtendedHeaderWriter=ExtendedHeaderWriter||require("./extended-header-writer.js"),ExtendedHeaderWriter(this.props).on("data",function(e){t.emit("data",e)}).on("error",function(e){t.emit("error",e)}).end()}this.emit("data",e),this.emit("header")},EntryWriter.prototype._process=function(){!this._didHeader&&!this._meta&&this._header();if(this._paused||this._processing)return;this._processing=!0;var e=this._buffer;for(var t=0;t<e.length;t++){var n=e[t];n===EOF?this._stream.end():this._stream.write(n);if(this._paused){this._processing=!1,t<e.length&&(this._needDrain=!0,this._buffer=e.slice(t+1));return}}this._buffer.length=0,this._processing=!1,this.emit("drain")},EntryWriter.prototype.destroy=function(){};