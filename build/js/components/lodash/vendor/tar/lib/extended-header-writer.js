function ExtendedHeaderWriter(e){var t=this;if(!(t instanceof ExtendedHeaderWriter))return new ExtendedHeaderWriter(e);t.fields=e;var n={path:("PaxHeader"+path.join("/",e.path||"")).replace(/\\/g,"/").substr(0,100),mode:e.mode||438,uid:e.uid||0,gid:e.gid||0,size:0,mtime:e.mtime||Date.now()/1e3,type:"x",linkpath:"",ustar:"ustar\0",ustarver:"00",uname:e.uname||"",gname:e.gname||"",devmaj:e.devmaj||0,devmin:e.devmin||0};EntryWriter.call(t,n),t.props=n,t._meta=!0}function encodeFields(e,t,n,r){return Object.keys(e).forEach(function(i){var s=e[i],o=tar.numeric[i];t&&(i=t+"."+i);if(i===e.type&&s===!0)return;switch(i){case"mode":case"cksum":case"ustar":case"ustarver":case"prefix":case"basename":case"dirname":case"needExtended":case"block":case"filter":return;case"rdev":if(s===0)return;break;case"nlink":case"dev":case"ino":i="SCHILY."+i;break;default:}if(s&&typeof s=="object"&&!Buffer.isBuffer(s))encodeFields(s,i,n,r);else{if(s===null||s===undefined)return;n.push.apply(n,encodeField(i,s,r))}}),n}function encodeField(e,t,n){if(e.charAt(0)===e.charAt(0).toLowerCase()){var r=e.split(".")[0];tar.knownExtended[r]||(e="NODETAR."+e)}if(n&&e.charAt(0)!==e.charAt(0).toLowerCase())return[];typeof val=="number"&&(val=val.toString(10));var i=new Buffer(" "+e+"="+t+"\n"),s=Math.floor(Math.log(i.length)/Math.log(10))+1;i.length+s>=Math.pow(10,s)&&(s+=1);var o=s+i.length,u=new Buffer(""+o);if(u.length+i.length!==o)throw new Error("Bad length calculation\nlen="+o+"\n"+"lenBuf="+JSON.stringify(u.toString())+"\n"+"lenBuf.length="+u.length+"\n"+"digits="+s+"\n"+"s="+JSON.stringify(i.toString())+"\n"+"s.length="+i.length);return[u,i]}module.exports=ExtendedHeaderWriter;var inherits=require("../vendor/inherits/inherits.js"),EntryWriter=require("./entry-writer.js");inherits(ExtendedHeaderWriter,EntryWriter);var tar=require("../tar.js"),path=require("path"),inherits=require("../vendor/inherits/inherits.js"),TarHeader=require("./header.js");ExtendedHeaderWriter.prototype.end=function(){var e=this;if(e._ended)return;e._ended=!0,e._encodeFields();if(e.props.size===0){e._ready=!0,e._stream.end();return}e._stream.write(TarHeader.encode(e.props)),e.body.forEach(function(t){e._stream.write(t)}),e._ready=!0,this._stream.end()},ExtendedHeaderWriter.prototype._encodeFields=function(){this.body=[],this.fields.prefix&&(this.fields.path=this.fields.prefix+"/"+this.fields.path,this.fields.prefix=""),encodeFields(this.fields,"",this.body,this.fields.noProprietary);var e=this;this.body.forEach(function(t){e.props.size+=t.length})};